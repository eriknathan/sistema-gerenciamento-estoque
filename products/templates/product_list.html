{% extends "base.html" %}

{% block title %}
SGE - Produtos
{% endblock %}

{% block content %}
    <div class="page-header">
        <h1>Produtos</h1>
        <p>Consulte e gerencie todos os produtos do seu estoque.</p>
    </div>
    
    <div class="row">
        <div class="col-xl-3 col-md-6">
            <div class="metric-card-simple bg-blue">
                <div class="card-title">Quantidade de Produtos</div>
                <div class="card-value">{{ total_products_count|default:0 }}</div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="metric-card-simple bg-red">
                <div class="card-title">Custo de Estoque</div>
                <div class="card-value">R$ {{ total_stock_cost|floatformat:2|default:"0,00" }}</div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="metric-card-simple bg-green">
                <div class="card-title">Valor do Estoque</div>
                <div class="card-value">R$ {{ total_stock_value|floatformat:2|default:"0,00" }}</div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="metric-card-simple bg-yellow">
                <div class="card-title">Lucro de Estoque</div>
                <div class="card-value">R$ {{ total_stock_profit|floatformat:2|default:"0,00" }}</div>
            </div>
        </div>
    </div>

    <div class="content-wrapper-card mt-3">
        <form method="get" action="{% url 'product_list' %}" class="row g-3">
            
            <div class="col-md-5">
                <input type="text" class="form-control" name="title" value="{{ request.GET.title }}" placeholder="Buscar por Título...">
            </div>
            <div class="col-md-5">
                <input type="text" class="form-control" name="serie_number" value="{{ request.GET.serie_number }}" placeholder="Buscar por Número de Série...">
            </div>
            <div class="col-md-2 d-grid">
                <button class="btn btn-primary" type="submit"><i class="bi bi-search me-1"></i> Buscar</button>
            </div>

            <div class="col-md-5">
                <select class="form-select" name="category_id">
                    <option value="">Todas as categorias</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {% if request.GET.category_id == category.id|stringformat:"s" %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-5">
                <select class="form-select" name="brand_id">
                    <option value="">Todas as Marcas</option>
                    {% for brand in brands %}
                    <option value="{{ brand.id }}" {% if request.GET.brand_id == brand.id|stringformat:"s" %}selected{% endif %}>
                        {{ brand.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2 d-grid">
                <button class="btn btn-secondary" type="submit"><i class="bi bi-funnel-fill me-1"></i> Filtrar</button>
            </div>

        </form>

            <hr style="border-color: var--border-color); margin: 1.5rem 0;">
            
            <div class="d-flex justify-content-end">
                <a href="{% url 'product_create' %}" class="btn btn-success" id="btn-novo-produto">
                    <i class="bi bi-plus-lg"></i> Novo Produto
                </a>
            </div>

            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Título</th>
                            <th scope="col">Categoria</th>
                            <th scope="col">Marca</th>
                            <th scope="col">P. Custo</th>
                            <th scope="col">P. Venda</th>
                            <th scope="col">Nº Série</th>
                            <th scope="col">Estoque</th>
                            <th scope="col">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in object_list %}
                        <tr>
                            <th scope="row">{{ product.id }}</th>
                            <td><strong>{{ product.title }}</strong></td>
                            <td>{{ product.category.name|default:"-" }}</td>
                            <td>{{ product.brand.name|default:"-" }}</td>
                            <td>R$ {{ product.cost_price|floatformat:2 }}</td>
                            <td>R$ {{ product.selling_price|floatformat:2 }}</td>
                            <td>{{ product.serie_number|default:"-" }}</td>
                            <td>{{ product.quantity|default:0 }}</td>
                            <td class="action-buttons">
                                <a href="{% url 'product_detail' product.id %}" class="btn btn-sm btn-detail" title="Detalhes">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a href="{% url 'product_update' product.id %}" class="btn btn-sm btn-edit" title="Editar">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{% url 'product_delete' product.id %}" class="btn btn-sm btn-delete" title="Excluir">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="9" class="text-center">Nenhum produto encontrado.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% include 'components/_pagination.html' %}
            
        </div>
    </div>

{% endblock %}
